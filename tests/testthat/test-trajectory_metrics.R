test_that("depth and duration are correct for an only-growing trajectory", {
  t <- seq(0, 10, by = 0.1)
  y <- 1 + sqrt(t)
  depth <- depth_of_response(y)
  dur <- duration_of_response(t, y)
  br <- best_response(y)
  expect_lt(br, 0)
  expect_equal(depth, 0)
  expect_equal(dur$start, 0)
  expect_equal(dur$end, 0)
  expect_false(dur$response_exists)
  expect_false(dur$response_endures)
  plt <- trajectory_plot(t, y)
  expect_s3_class(plt, "ggplot")
})

test_that("depth and duration are correct for an only-shrinking trajectory", {
  t <- seq(0, 10, by = 0.1)
  y <- exp(1 - sqrt(t))
  depth <- depth_of_response(y)
  dur <- duration_of_response(t, y)
  br <- best_response(y)
  expect_equal(depth, br)
  expect_gt(depth, 0.95)
  expect_lt(depth, 1)
  ed <- (y[1] - min(y)) / (y[1])
  expect_equal(depth, ed)
  expect_equal(dur$end - dur$start, 9.8)
  expect_true(dur$response_endures)
  expect_true(dur$response_exists)
  plt <- trajectory_plot(t, y)
  expect_s3_class(plt, "ggplot")
  TTB120 <- ttb120(t, y)
  expect_equal(TTB120, 10)
})

test_that("depth and duration are correct for a non-monotonic trajectory", {
  t <- seq(0, 10, by = 0.1)
  y <- exp(1 - sqrt(t) + sin(t))
  depth <- depth_of_response(y)
  dur <- duration_of_response(t, y)
  expect_equal(dur$start, 1.8)
  expect_equal(dur$end, 5.6)
  plt <- trajectory_plot(t, y)
  expect_s3_class(plt, "ggplot")
  expect_true(dur$response_exists)
  expect_false(dur$response_endures)
  expect_equal(depth, 0.9754317)
  TTB120 <- ttb120(t, y)
  expect_equal(TTB120, 10)
})


test_that("depth and duration are correct for a regrowth trajectory", {
  t <- seq(0, 10, by = 0.1)
  y <- exp(1 - sqrt(t) + sin(t)) + 0.04 * t^2
  depth <- depth_of_response(y)
  dur <- duration_of_response(t, y)
  TTB120 <- ttb120(t, y)
  expect_equal(TTB120, 8.7)
  plt <- trajectory_plot(t, y)
  expect_s3_class(plt, "ggplot")
  expect_true(dur$response_exists)
  expect_false(dur$response_endures)
  expect_equal(round(depth, 5), 0.71295)
})
